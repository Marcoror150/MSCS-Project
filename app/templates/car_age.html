<!doctype html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>   
        <!-- Icons -->
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
        <!-- Include CSS -->
        <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">

        <title>Accident Data Based on Age of Car</title>
    </head>
    <body>
        
        <nav class="navbar navbar-toggleable-md navbar-expand-sm bg-dark navbar-dark bg-primary">

                <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo02" aria-controls="navbarTogglerDemo02" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
            <!-- Logo, with link to the home page -->
            <a class="navbar-brand" href="{{ url_for('index') }}">C.A.R.S.</a>

            <!-- Make these Drop-downs/buttons left-jusitfied, the help button right-justified... -->
            <ul class="navbar-nav mr-auto mt-2 mt-md-0">
                <!-- Drop-down menu for categories -->
                <div class="dropdown">
                    <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Categories
                    </button>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                        <a class="dropdown-item" href="{{ url_for('car_age') }}">Car Age</a>
                        <a class="dropdown-item" href="{{ url_for('multiple_fatalities') }}">Make, Model, and Year</a>
                        <a class="dropdown-item" href="{{ url_for('location') }}">Location</a>
                        <a class="dropdown-item" href="{{ url_for('metrics') }}">Metrics</a>
                    </div>
                </div>
            </ul>

            <!-- Button for Help Modal-->
            <button type="button" class="btn btn-success" data-toggle="modal" data-target="#myModal">
                <i class="fas fa-question"></i>
            </button>

        </nav>

        <div class="container">
            <div class="jumbotron">
                <h1 class="font-weight-bold">Accident Data Based on Age of Car</h1>        
            </div>
        </div>

        <!-- Year drop-downs and add/remove fields -->
        <div class="container my-4">
            <div class="card my-4 offset-2 col-8">
                <div class="card-body" >
                <form action="javascript:ageSubmit()">
                    <div id="dynamic-field-1" class="form-group dynamic-field">
                        <div class="dropdown" style="display:flex; justify-content:center;">
                                <label for="year"><b>Select Year:</b></label> 
                                <input list="years" name="year"> 
                                <datalist id="years"> 
                                    <option value="1923">
                                    <option value="1924">
                                    <option value="1925">
                                    <option value="1926">    
                                    <option value="1927">
                                    <option value="1928">    
                                    <option value="1929">
                                    <option value="1930">
                                    <option value="1931">
                                    <option value="1932">
                                    <option value="1933">
                                    <option value="1934">
                                    <option value="1935">
                                    <option value="1936">
                                    <option value="1937">
                                    <option value="1938">
                                    <option value="1939">
                                    <option value="1940">
                                    <option value="1941">
                                    <option value="1942">
                                    <option value="1943">
                                    <option value="1944">
                                    <option value="1945">
                                    <option value="1946">
                                    <option value="1947">
                                    <option value="1948">
                                    <option value="1949">
                                    <option value="1950">
                                    <option value="1951">
                                    <option value="1952">
                                    <option value="1953">
                                    <option value="1954">
                                    <option value="1955">
                                    <option value="1956">
                                    <option value="1957">
                                    <option value="1958">
                                    <option value="1959">
                                    <option value="1960">    
                                    <option value="1961">
                                    <option value="1962">    
                                    <option value="1963">
                                    <option value="1964">
                                    <option value="1965">
                                    <option value="1966">
                                    <option value="1967">
                                    <option value="1968">
                                    <option value="1969">
                                    <option value="1970">
                                    <option value="1971">
                                    <option value="1972">
                                    <option value="1973">
                                    <option value="1974">
                                    <option value="1975">
                                    <option value="1976">
                                    <option value="1977">
                                    <option value="1978">
                                    <option value="1979">
                                    <option value="1980">
                                    <option value="1981">
                                    <option value="1982">
                                    <option value="1983">
                                    <option value="1984">
                                    <option value="1985">
                                    <option value="1986">
                                    <option value="1987">
                                    <option value="1988">
                                    <option value="1989">
                                    <option value="1990">
                                    <option value="1991">
                                    <option value="1992">
                                    <option value="1993">
                                    <option value="1994">
                                    <option value="1995">
                                    <option value="1996">
                                    <option value="1997">
                                    <option value="1998">
                                    <option value="1999">
                                    <option value="2000">
                                    <option value="2001">
                                    <option value="2002">
                                    <option value="2003">
                                    <option value="2004">
                                    <option value="2005">
                                    <option value="2006">
                                    <option value="2007">
                                    <option value="2008">
                                    <option value="2009">
                                    <option value="2010">
                                    <option value="2011">
                                    <option value="2012">
                                    <option value="2013">
                                    <option value="2014">
                                    <option value="2015">
                                    <option value="2016">
                                </datalist>
                            </div>
                        </div>
                    <div class="clearfix mt-4" style="display:flex; justify-content:center;">
                    <button type="button" id="add-button" class="btn btn-primary float-left text-uppercase shadow-sm"><i class="fas fa-plus fa-fw"></i>Add</button>
                    <button type="button" id="remove-button" class="btn btn-primary float-left text-uppercase ml-1" disabled="disabled"><i class="fas fa-minus fa-fw"></i>Remove</button>
                    <button type="submit" class="btn btn-primary float-right text-uppercase shadow-sm" style="margin: 0px 5px;">Submit</button>
                    </div>
                </form>
                </div>
            </div>
            <p class="text-muted font-italic">Description: <span class="font-weight-light">Add or remove fields for vehicle years. Please select a year from the drop-down list (1923-2016).</span></p>
        </div>

        <div id="result" class = "container-fluid my-4"></div>

        <!-- Help Modal Contents -->
        <div class="modal" id="myModal">
            <div class="modal-dialog">
                <div class="modal-content">
        
                    <!-- Modal Header -->
                    <div class="modal-header">
                        <h4 class="modal-title"><b>Help Screen</b></h4>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>
        
                    <!-- Modal body -->
                    <div class="modal-body">
                        <p>
                            Please read the below content to hopefully answer any questions you have.
                        </p>

                        <p>
                            <b>C.A.R.S.:</b>
                                By clicking the C.A.R.S. logo (Crash Analysis Reporting System), you will be redirected to the home page.
                        </p>

                        <p>
                            <b>Categories:</b>
                                If you click on the Categories drop-down menu, you will be given the option to pick one of three categories.
                                The first option allows you to analyze the the likelihood of a general car accident based on the age of a car.
                                The second option is for analyzing the likelihood of an accident having multiple fatalities given a certain
                                car (make and model). The final option allows you to calculate the likelihood of an accident when given
                                a specific geographic location.
                        </p>

                        <p>
                            <b>Select Year:</b>
                                To calculate the accident data based on the age of a car, use the "Select Year:" drop-down and select
                                the year you wish to analyze (1923-2016). You can either press submit from here, or if you want to analyze
                                accident data from multiple years, you can use the green add button to add more fields and examine multiple
                                years. If you add too many fields and do not wish to view all of those, use the red remove button to get rid
                                of the most recent field that you added.
                        </p>

                        <p>
                            For any further questions, please refer to our GitHub repository: <a href="https://github.com/Marcoror150/MSCS-Project">MSCS-Project</a>
                        </p>

                    </div>
        
                    <!-- Modal footer -->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                    </div>
        
                </div>
            </div>
        </div>

        <script>
            function ageSubmit(){
                formData = $('form').serializeArray()
                data = []
                //  formData.array.forEach(element => {
                for (element of formData){
                    // console.log(element)
                    if (element.value == ""){
                        alert("Please make sure to fill all fields with valid values")
                        return false
                    }
                    data.push({
                        'year':element.value
                    })
                }
                console.log("data = ", data)

                var postData = {'data':data}
                
                console.log(postData);
                // Assign handlers immediately after making the request,
                // and remember the jqxhr object for this request
                $.ajax({
                    url: 'car_age',
                    type: 'post',
                    dataType: 'json',
                    contentType: 'application/json',
                    success: function (data) {
                        // alert(data)
                        console.log(data)
                        var text = "<div id = \'resultTable\' class = \"card my-4 offset-1 col-10\"><table> \
                            <tr><th>Year</th> \
                                <th>Year Percentage</th> \
                                <th>Weighted Value</th> \
                                <th>Prediction</th> \
                                </tr>" 
                        for (row of data['responses']){
                            text += "<tr>"
                            text += "<td>" + row['year'] + "</td>"
                            text += "<td>" + row['yearPct'] + "</td>"
                            text += "<td>" + row['weightedPct'] + "</td>"
                            text += "<td>" + row['prediction'] + "</td>"
                            text += "</tr>"
                        } 
                        text += "</table></div>"
                        $('#result').html(text)
                    },
                    data: JSON.stringify(postData)
                });
            }

            $(document).ready(function() {
            var buttonAdd = $("#add-button");
            var buttonRemove = $("#remove-button");
            var className = ".dynamic-field";
            var count = 0;
            var field = "";
            var maxFields = 93;

            function totalFields() {
                return $(className).length;
            }

            function addNewField() {
                count = totalFields() + 1;
                field = $("#dynamic-field-1").clone();
                field.attr("id", "dynamic-field-" + count);
                field.children("label").text("Year " + count);
                field.find("input").val("");
                $(className + ":last").after($(field));
            }

            function removeLastField() {
                if (totalFields() > 1) {
                $(className + ":last").remove();
                }
            }

            function enableButtonRemove() {
                if (totalFields() === 2) {
                buttonRemove.removeAttr("disabled");
                buttonRemove.addClass("shadow-sm");
                }
            }

            function disableButtonRemove() {
                if (totalFields() === 1) {
                buttonRemove.attr("disabled", "disabled");
                buttonRemove.removeClass("shadow-sm");
                }
            }

            function disableButtonAdd() {
                if (totalFields() === maxFields) {
                buttonAdd.attr("disabled", "disabled");
                buttonAdd.removeClass("shadow-sm");
                }
            }

            function enableButtonAdd() {
                if (totalFields() === (maxFields - 1)) {
                buttonAdd.removeAttr("disabled");
                buttonAdd.addClass("shadow-sm");
                }
            }

            buttonAdd.click(function() {
                addNewField();
                enableButtonRemove();
                disableButtonAdd();
            });

            buttonRemove.click(function() {
                removeLastField();
                disableButtonRemove();
                enableButtonAdd();
            });
            });
        </script>

        <script
        src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
        crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    </body>
</html>